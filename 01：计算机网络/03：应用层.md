### 应用层

------

[TOC]

##### 01：域名

- 计算机的唯一名称， 域名是需要注册的，当域名被注册后，就会被添加到大的域名注册商那里，包括被保存在 DNS 服务器里的 **IP 信息与域名有一种映射关系**；
- 虚假域名：被注册到别的域名之下的子域名；

##### 02：DNS 域名系统 (Domain Name System)

- 提供域名到IP地址之间的解析服务，**应用层协议**；
- DNS 域名服务器：采用分布式的结构，将域名空间信息存储、解析工作分布到多台域名服务器上；
- 本地域名服务器：是电脑解析时的**默认**域名服务器，即电脑中设置的首选 DNS 服务器和备选 DNS 服务器；
- DNS是非常优秀的高并发分布式系统，**通过层次结构将服务进行拆分**，流量分散到多个服务器中。又通过加入**多级缓存**，让每个层级实际接收到的缓存大大减小，因此大大提高了系统的性能。
- **根域服务器的IP会以配置的形式加载到每一台DNS服务器当中**。因此访问任意一台DNS服务器都能轻松找到根域对应的IP地址。
- DNS在传输层既能使用UDP也能使用TCP协议。当传输数据量**小于512Byte**时会使用UDP，否则使用TCP。
- 虽然根域只有13个IP，但不代表只有13台服务器，准确的说，应该是**十三组服务器，每组服务器都共用同一个IP**，国内已经有非常多的镜像服务器，利用**任播技术**，只要能就近访问到其中一台就行。
  - 基于UDP的DNS报文不应该超过 512Byte，刨去DNS本身的报头信息，算下来**大概能放13个IP（IPV4）**。

- <img src="/Users/likang/Code/Git/Network/01：计算机网络/photos/DNS.png" alt="DNS" style="zoom:55%;" />

###### 域名解析过程

- dig +trace www.baidu.com
  - 命令查看从根域获取域名解析的流程；

- 以正向解析为例（域名解析成 IP 地址）
  1. 首先搜索**浏览器的 DNS 缓存**，缓存中维护一张域名与 IP 地址的对应表；
  2. 若没有命中，则继续搜索**操作系统的 DNS 缓存**；
  3. 若仍然没有命中，则操作系统将域名发送至**本地域名服务器**，本地域名服务器查询自己的 DNS 缓存，查找成功则返回结果（注意：主机和本地域名服务器之间的查询方式是**递归查询**）；
  4. 若本地域名服务器的 DNS 缓存没有命中，则本地域名服务器向上级域名服务器进行查询，通过以下方式进行**迭代查询**
     - 本地域名服务器和其他域名服务器之间的查询方式是迭代查询，**防止根域名服务器压力过大；**
     - 首先本地域名服务器向**根域名服务器**发起请求，根域名服务器是最高层次的，它并不会直接指明这个域名对应的 IP 地址，而是返回顶级域名服务器的地址，也就是说给本地域名服务器指明一条道路，让他去这里寻找答案
     - 本地域名服务器拿到这个**顶级域名服务器**的地址后，就向其发起请求，获取**权限域名服务器**的地址
     - 本地域名服务器根据**权限域名服务器**的地址向其发起请求，最终得到该域名对应的 IP 地址；
  5. **本地域名服务器**将得到的 IP 地址返回给操作系统，同时自己将 IP 地址**缓存**起来；
  6. **操作系统**将 IP 地址返回给浏览器，同时自己也将 IP 地址**缓存**起来；
  7. 最终，**浏览器**就得到了域名对应的 IP 地址，并将 IP 地址**缓存**起来；

###### CDN 缓存（内容分发网络）

- 对象型存储服务（OSS）：获取该资源时，在其基础上加一层缓存；
- 将**内容从原始服务器复制到多个位置**，这样用户就可以**从最近的数据中心获取内容**，减少延迟，提高加载速度。
- CDN  域名服务器：会返回离用户最近的CDN节点IP，用户请求数据，若不存在，则回源获取数据；

##### 03：DHCP（Dynamic Host Configuration Protocol）

- **动态主机配置协议**：自动为网络中的主机分配IP地址，应用层协议；
- C/S 模式
  - 服务器：port：67，UDP
  - 客户端：port：68，UDP

###### 分配过程

1. Discover（广播）
   - 源IP：0.0.0.0—目的IP：255.255.255.255（局域网内广播，网段内部）
   - DHCP客户端**携带MAC地址和计算机域名**，寻找DHCP服务器；
2. OFFER（广播）
   - 所有到Discover的请求的DHCP服务器，都要返回此信息；
   - 选择一个**合适的IP地址，连同IP地址租约期限和其他配置信息**，响应给DHCP客户端；
3. REQUEST（广播）
   - 广播告知自己的选择，通知其他DHCP服务器回收IP；
4. ACK（广播）
   - DHCP服务器根据 DHCP-REQUEST 报文中携带的MAC地址来查找有没有相应的**租约记录**。如果有，则发送 DHCP-ACK报文作为应答，通知 DHCP 客户端可以使用分配的IP地址。

##### 04：URL

- `<protocol>://<user>:<password>@<host>:<port>/url_path`
- user，password@，port 为可选值

##### 05：主要协议介绍

- **TCP：**传输控制协议
  - TCP 负责在数据传送之前将它们分割为 IP 包，然后在它们到达的时候将它们重组
- **IP：**网际协议（Internet Protocol）
  - IP 负责在因特网上发送和接收数据包
- HTTP - 超文本传输协议(Hyper Text Transfer Protocol)

  -  HTTP 用于从 web 客户端（浏览器）向 web 服务器发送请求，并从 web 服务器向 web 客户端返回内容（网页）
- HTTPS - 安全的 HTTP（HTTP Secure）

  - 作为有代表性的应用，HTTPS 会用于处理信用卡交易和其他的敏感数据
- SSL - 安全套接字层（Secure Sockets Layer）

  - SSL 协议用于为安全数据传输加密数据
- **FTP：**文件传输协议
  - 端口号20、21，控制端口一般为21，而数据端口不一定是20，这和FTP的应用模式有关，如果是主动模式，应该为20，如果为被动模式，由服务器端和客户端协商而定
  - UDP 协议
- NTP - 网络时间协议（Network Time Protocol）

  - NTP 用于在计算机之间同步时间（钟）
- SNMP - 简单网络管理协议（Simple Network Management Protocol）

  - SNMP 用于计算机网络的管理
- **ICMP：** 产生错误和通知消息以增强互联网的可管理性【网络层】
- **ARP - 地址解析协议**（Address Resolution Protocol）【网络层】
  - ARP：用于基于 IP 地址的计算机网卡的硬件地址
- **RARP：反向地址转换协议**（Reverse Address Resolution Protocol）
  - RARP：基于硬件地址来查找的 IP 地址
- BOOTP - 自举协议（Boot Protocol）

  - BOOTP 用于从网络启动计算机
- PPTP - 点对点隧道协议（Point to Point Tunneling Protocol）

  - PPTP 用于私人网络之间的连接（隧道）

 
