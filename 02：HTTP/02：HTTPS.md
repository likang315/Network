### HTTPS

------

[TOC]

##### 01：HTTPS (HTTP secure)

​	用 SSL 或 TLS 组合的方式**建立安全通信线路之后在使用HTTP通信**被称为HTTPS，使用HTTPS 通信地址栏会带有**锁标志**；

- **HTTP + SSL/TSL（加密 + 认证 + 完整性）= HTTPS**
  - SSL 不仅提供加密手段还提供证书和验证报文的完整性方式；

- **中间人攻击：**请求或响应传输途中，遭遇攻击者拦截并篡改内容的攻击；

##### 02：解决 HTTP 的三个问题

###### SSL加密

- 在交换密钥环节，使用**非对称密钥加密（RSA）**，之后建立的通道，通信则使用**对称密钥(DES 或 RC4)**加密方式；
  1. 服务器把自己的身份信息**以 SSL 证书的形式**发回给浏览器。
     - 证书里面包含了网站地址，**加密公钥**，以及**证书的颁发机构等信息**；
  2. 客户端有公钥，服务器有私钥，客户端**用公钥对对称密钥（随机生成的）进行加密**，将加密后的对称密钥发送给服务器，服务器**用私钥对其进行解密**，所以客户端和服务器可用对称密钥来进行通信；

###### 验证报文的完整性（数字签名）

- 使用**散列算法**如SHA1，MD5将传输内容 hash 一次获得hash值，**即摘要**。客户端使用服务端的公钥对摘要和信息内容进行加密，然后传输给服务端，服务端使用私钥进行解密获得原始内容和摘要值，这时**服务端使用相同的 hash 算法对原始内容进行 hash ，然后与摘要值比对**，如果一致，说明信息是完整的。

###### 身份认证（SSL证书）

- 单向认证
  - 客户端认证服务端身份是否正确，客户端获取证书之后，向认证机构（CA）认证证书的合法性；
- 双向认证
  - 除了客户端需要认证服务端以外，增加了**服务端对客户端的认证**；
  - 客户端将自己的证书以及公钥发送给服务端进行认证；

##### 03：SSL/TLS 协议

- SSL协议及其升级版 **TLS 协议**，是一种实现**网络通信加密的安全协议**，可在客户端（浏览器）和服务器（网站）之间**建立一条加密通道**，保证数据在传输过程中不被窃取或篡改。
- TLS（Transport Layer Security，安全传输层)，TLS 是建立在**传输层TCP协议**之上的协议，**服务于应用层**，它的前身是SSL（Secure Socket Layer，安全套接字层），它实现了将**应用层的报文**进行加密后再交由TCP进行传输的功能。

###### SSL 证书

- **SSL证书**，也称为**服务器SSL证书**，是遵守SSL协议的一种数字证书，由全球信任的证书颁发机构(CA)验证服务器身份后颁发。将SSL证书安装在网站服务器上，可实现**网站身份验证和数据加密传输**双重功能。
- **EV SSL证书**：是Extended Validation SSL的缩写，指**遵循全球统一的严格身份验证标准**颁发的SSL证书，是目前业界最高安全级别的SSL证书。用户访问部署了EV SSL证书的网站，不仅浏览器地址栏会显示安全锁标志，而且浏览器地址栏会变成绿色。

###### SSL 建立原理

<img src="https://github.com/likang315/Network/blob/master/02：HTTP/photos/tls.png?raw=true" style="zoom:50%;" />

- 客户端首先发送Client Hello消息到服务端【**第一阶段通信协商**】
  - Client Hello：消息里包含了一个客户端生成的随机数 **Random1**、客户端支持的**加密套件（Support Ciphers）**和 **SSL Version** 等信息。
- 服务端向客户端发送 Server Hello 消息；
  - Server  Hello：消息包含会从 Client Hello 传过来的 Support Ciphers 里**确定一份加密套件**，这个套件决定了后续加密和生成摘要时具体使用哪些算法，另外还会生成一份随机数 **Random2**。注意，至此客户端和服务端都拥有了两个随机数（Random1+ Random2），这两个随机数会在后续生成对称秘钥时用到。
- Certificate消息（可选）：第一次建立必须要有证书【**第二阶段**】
  - 一般情况下，除了会话恢复时不需要发送该消息，在SSL握手的全流程中，都需要包含该消息。**消息包含一个X.509证书，证书中包含公钥，发给客户端用来验证签名或在密钥交换的时候给消息加密**。
- Server Key Exchange（可选）
  - 取决于**使用的密钥交换算法**，在使用RSA密钥交换时，"Server Key Exchange"阶段不是必需的，因为**服务器的公钥已经包含在证书中**。但是，当使用诸如Diffie-Hellman或ECDHE等协议时，服务器会在"Server Key Exchange"消息中发送用于协商会话密钥的相关信息，而不是直接发送公钥。
- Certificate Request（可选）：可以是单向的身份认证，也可以双向认证
  - 要求客户端发他自己的证书过来进行验证。该消息中包含**服务器端支持的证书类型**（RSA、DSA、ECDSA等）和**服务器端所信任的所有证书发行机构的CA列表**，客户端会用这些信息来筛选证书。
- Server Hello Done
  - 表示服务器已经将所有信息发送完毕，接下来等待客户端的消息。
- Certificate（可选）【**第三阶段**】
  - 若是双向验证，服务器端在之前发送的Certificate Request消息中包含了服务器端所支持的证书类型和CA列表，因此**客户端会在自己的证书中选择满足这两个条件的第一个证书发送过去**。若客户端没有证书，则发送一个no_certificate警告。
- Client Key exchange
  - pre-master secret 随机数：客户端会生成一个随机数，然后**使用服务器的公钥对该随机数进行加密**。
  - 一旦客户端和服务器都获得了"pre-master secret"，它们会**使用协商的加密算法和该"pre-master secret"生成会话密钥（加密解密数据的对称密钥）**；
- Certificate verify（可选）
  - 只有在客户端发送了自己证书到服务器端（双向验证），这个消息才需要发送。其中包含一个签名，对从第一条消息以来的所有握手消息的HMAC值（用master_secret）进行签名。
- Change Cipher Spec【**第四阶段**】
  - 编码改变通知，用于告知服务端随后的信息都将用双方约定的加密方法和密钥发送；
  - ChangeCipherSpec 是一个独立的协议；
- Client Finished
  - 客户端握手结束通知, **表示客户端的握手阶段已经结束**。这一项同时也是前面发送的所有内容的hash值，用来供服务器校验，此数据是为了在正式传输应用数据之前对刚刚握手建立起来的加解密通道进行验证。
- Change Cipher Spec
  - 服务端向客户端发送的编码改变通知消息；
- Server Finished
  - 服务端握手结束通知。
  - 在这个阶段之后，TLS 会使用**协商好的加密算法和对称密钥来保证通信数据的完整性和机密性**。

##### 04：SSL 慢分为两种

1. 通信慢；
2. 由于大量消耗CPU及内存资源，导致处理速度变慢，网络负载过重；


##### 05：CA 机构（Certificate Authority）

- **数字证书认证机构**：负责验证、签发和管理数字证书的可信任实体。
  - CA使用自己的私钥对申请者证书信息和公钥进行数字签名，生成数字证书；
- CA 证书是 CA 自己的证书，SSL 证书是颁发的证书；

##### 06：认证功能

- Web页面只允许特定的人浏览；

- 认证方式

  1. BASIC认证（基本认证）：在基本认证中，客户端向服务器发送加密的用户名和密码，并且使用Base64编码的方式进行传输；

  2. ###### DIGEST认证（摘要认证）：使用质询/响应的方式，不会直接发送明文密码

    - 质询响应方式：一开始一方会先发送认证要求给另一方，接着使用从**另一方那接受到质询码（Base64编码）计算生成响应码（MD5运算） 最后返回响应码给对方进行验证**。

  3. SSL客户端认证：借助 HTTPS 客户端证书完成认证；

  4. 表单认证：客户端会向服务器上的Web应用程序发送登录信息，按登录信息的验证结果验证；

    - 使用Cookie来管理Session（会话）

##### 07：基于 HTTP 的追加协议

- WebSocket：它允许在 Web 浏览器和 Web 服务器之间建立全双工通信，从而实现实时数据传输。
- WebSocket 的建立过程通常是**从一个 HTTP 请求开始，然后升级到 WebSocket 协议**，这使得它能够通过 Web 服务器和客户端之间的单个 TCP 连接进行双向通信。


##### 08：Web的攻击技术

###### 攻击模式

- 主动攻击：攻击者直接访问Web应用，把攻击代码传入的攻击模式
- 被动攻击：利用圈套策略（诱使用户）执行攻击代码的攻击模式

###### 因输出转义不完全引发的安全漏洞 

1. 跨站脚本攻击：Web网站注册用户的浏览器内运行非法的HMTL和JS代码进行的一种攻击 
2. SQL注入攻击：针对Web应用使用的数据库，通过运行非法的SQL而产生的攻击
3. OS命令注入攻击：通过web应用，执行非法的操作系统命令（调用shell函数）达到攻击的目的
4. HTTP首部注入攻击：通过在响应首部字段内插入换行，添加任意响应首部或主体的攻击

###### 会话劫持

- 攻击者通过某种手段得到用户的会话ID，并伪装成用户，达到攻击的目的


###### 密码破解

- 算出密码，突破认证；
- 穷举法：指对所有密钥集合构成的密钥空间进行穷举；
- 字典攻击：利用事先收集好的候选密码，经过各种方式组合存入字典，枚举字典中的密码通过认证；
- 彩虹表：明文密码及与之对应的散列值构成的一张数据库表，是一种实现制作庞大的彩虹表；

###### 点击劫持

- 利用透明的按钮或链接做成陷阱，覆盖在Web页面之上，然后诱使用户点击访问内容的一种手段；


###### DOS攻击(拒绝服务攻击)

- 一种让运行中的服务呈停止状态的攻击，发送大量请求让服务器难以分辨何为正常请求，何为攻击请求；


###### 后门程序

- 开发人员设置的隐藏入口；    