### HTTPS

------

[TOC]

##### 01：HTTPS (HTTP secure)：

​	用SSL (安全套接层) 和TLS（安全层传输协议) 组合的方式**建立安全通信线路之后在使用HTTP通信**被称为HTTPS；

- **HTTP + 加密 + 认证 + 完整性 = HTTPS**
- SSL不仅提供加密手段还提供证书，而部署了SSL证书的网站，可以采用安全的HTTPS协议进行访问
- 用HTTPS通信地址栏会带有锁标志；，
- **中间人攻击：**请求或响应传输途中，遭遇攻击者拦截并篡改内容的攻击；
- **数字证书认证机构**：对已申请者的公开密钥做数字签名，然后把**公开密钥放入到公钥证书后绑定在一起**，来验证公开密钥的真实性；

##### 02：HTTPS 解决HHTP 三个问题

###### SSL加密（交换密钥）

- 在交换密钥环节，使用**非对称密钥加密（RSA）**，之后建立的通道，通信则使用**对称密钥(DES 或 RC4)**加密方式；
  - 服务器把自己的身份信息**以证书的形式**发回给浏览器。证书里面包含了网站地址，**加密公钥**，以及证书的颁发机构等信息。 
  - 此时，客户端有公钥，服务器有私钥，客户端**用公钥对对称密钥（随机生成的）进行加密**，将加密后的对称密钥发送给服务器，服务器**用私钥对其进行解密**，所以客户端和服务器可用对称密钥来进行通信。

###### 验证报文的完整性（数字签名）

- 通用方法是使用**散列算法**如SHA1，MD5将传输内容hash一次获得hash值，**即摘要**。客户端使用服务端的公钥对摘要和信息内容进行加密，然后传输给服务端，服务端使用私钥进行解密获得原始内容和摘要值，这时**服务端使用相同的hash算法对原始内容进行hash，然后与摘要值比对**，如果一致，说明信息是完整的。

###### 身份认证（证书）

- 单向认证
  - 客户端认证服务端身份是否正确，客户端获取证书之后，向认证机构（CA）认证证书的合法性；
- 双向认证
  - 除了客户端需要认证服务端以外，增加了**服务端对客户端的认证**；
  - 客户端将自己的证书以及公钥发送给服务端进行认证；

##### 03：SSL/TLS 协议

- SSL协议及其升级版TLS协议，是一种实现**网络通信加密的安全协议**，可在客户端（浏览器）和服务器端（网站）之间**建立一条加密通道**，保证数据在传输过程中不被窃取或篡改。
- TLS（Transport Layer Security，安全 传输层)，TLS是建立在**传输层TCP协议**之上的协议，服务于应用层，它的前身是SSL（Secure Socket Layer，安全 套接字层），它实现了将**应用层的报文**进行加密后再交由TCP进行传输的功能。

###### SSL 证书

- **SSL证书**，也称为**服务器SSL证书**，是遵守SSL协议的一种数字证书，由全球信任的证书颁发机构(CA)验证服务器身份后颁发。将SSL证书安装在网站服务器上，可实现**网站身份验证和数据加密传输**双重功能。
- **EV SSL证书**：是Extended Validation SSL的缩写，指**遵循全球统一的严格身份验证标准**颁发的SSL证书，是目前业界最高安全级别的SSL证书。用户访问部署了EV SSL证书的网站，不仅浏览器地址栏会显示安全锁标志，而且浏览器地址栏会变成绿色。

###### SSL建立 原理

<img src="/Users/likang/Code/Git/Network/02：HTTP/photos/tls.png" style="zoom:67%;" />

- 客户端首先发送Client Hello消息到服务端【**第一阶段通信协商**】
  - Client Hello：消息里包含了一个客户端生成的随机数 **Random1**、客户端支持的**加密套件（Support Ciphers）**和 **SSL Version** 等信息。
- 服务端向客户端发送 Server Hello 消息；
  - Server  Hello：消息包含 会从 Client Hello 传过来的 Support Ciphers 里**确定一份加密套件**，这个套件决定了后续加密和生成摘要时具体使用哪些算法，另外还会生成一份随机数 **Random2**。注意，至此客户端和服务端都拥有了两个随机数（Random1+ Random2），这两个随机数会在后续生成对称秘钥时用到。
- Certificate消息（可选）：第一次建立必须要有证书【**第二阶段**】
  - 一般情况下，除了会话恢复时不需要发送该消息，在SSL握手的全流程中，都需要包含该消息。**消息包含一个X.509证书，证书中包含公钥，发给客户端用来验证签名或在密钥交换的时候给消息加密**。
- Server Key Exchange（可选）
  - 根据之前在Client Hello消息中包含的Cipher Suite信息，决定了密钥交换方式（例如RSA或者DH），因此在Server Key Exchange消息中便会包含完成密钥交换所需的一系列参数。
- Certificate Request（可选）：可以是单向的身份认证，也可以双向认证
  - 要求客户端发他自己的证书过来进行验证。该消息中包含**服务器端支持的证书类型**（RSA、DSA、ECDSA等）和**服务器端所信任的所有证书发行机构的CA列表**，客户端会用这些信息来筛选证书。
- Server Hello Done
  - 表示服务器已经将所有信息发送完毕，接下来等待客户端的消息。
- Certificate（可选）【**第三阶段**】
  - 若是双向验证，服务器端在之前发送的Certificate Request消息中包含了服务器端所支持的证书类型和CA列表，因此**客户端会在自己的证书中选择满足这两个条件的第一个证书发送过去**。若客户端没有证书，则发送一个no_certificate警告。

- Client Key exchange
  - 如果是RSA算法，会生成一个48字节的随机数，然后**用server的公钥加密后再放入报文中**。
  - 如果是DH 算法，将会用到两次Random1,2；

- Certificate verify（可选）
  - 只有在客户端发送了自己证书到服务器端（双向验证），这个消息才需要发送。其中包含一个签名，对从第一条消息以来的所有握手消息的HMAC值（用master_secret）进行签名。

- ChangeCipherSpec【**第四阶段**】
  - 编码改变通知，用于告知服务端随后的信息都将用双方约定的加密方法和密钥发送；
  - ChangeCipherSpec 是一个独立的协议；

- Clinet Finished
  - 客户端握手结束通知, **表示客户端的握手阶段已经结束**。这一项同时也是前面发送的所有内容的hash值，用来供服务器校验，此数据是为了在正式传输应用数据之前对刚刚握手建立起来的加解密通道进行验证。

- ChangeCipherSpec
  - 服务端向客户端发送的编码改变通知消息；

- Server Finished
  - 服务端握手结束通知。


##### 04：CA【Certificate Authority】

- **证书授权中心**，负责管理和签发证书的第三方机构，作用是检查证书持有者身份的合法性，并签发证书，以防证书被伪造或篡改。
- CA 证书就是CA颁发的证书。

##### 04：SSL 慢分为两种

1. 通信慢；
2. 由于大量消耗CPU及内存资源，导致处理速度变慢，网络负载过重；

##### 04：认证功能

- Web页面只允许特定的人浏览；

- 认证方式： 1：BASIC认证（基本认证） 2：DIGEST认证（摘要认证） 3：SSL客户端认证 4：表单认证

  - BASIC认证：Web服务器与通信客户端之间进行的认证方式（采用Base64编码方式）

  - ###### DIGEST认证：使用质询/响应的方式，不会直接发送明文密码

    - 质询响应方式：一开始一方会先发送认证要求给另一方，接着使用从**另一方那接受到质询码（Base64编码）计算生成响应码（MD5运算） 最后返回响应码给对方进行验证**

  - SSL客户端认证：借助HTTPS客户端证书完成认证的方式

  - 基于表单的认证：客户端会向服务器上的Web应用程序发送登录信息，按登录信息的验证结果验证

    - 使用Cookie来管理Session（会话）

##### 05：基于HTTP功能的追加协议

- WebSocket：Web浏览器和Web服务器之间全双工通信，是基于HTTP协议的，先HTTP发送请求然后切换成WebScoket协议通信。


##### 07：Web的攻击技术

###### 攻击模式

- 主动攻击：攻击者直接访问Web应用，把攻击代码传入的攻击模式
- 被动攻击：利用圈套策略（诱使用户）执行攻击代码的攻击模式

###### 因输出转义不完全引发的安全漏洞 

1. 跨站脚本攻击：Web网站注册用户的浏览器内运行非法的HMTL和JS代码进行的一种攻击 
2. SQL注入攻击：针对Web应用使用的数据库，通过运行非法的SQL而产生的攻击
3. OS命令注入攻击：通过web应用，执行非法的操作系统命令（调用shell函数）达到攻击的目的
4. HTTP首部注入攻击：通过在响应首部字段内插入换行，添加任意响应首部或主体的攻击

###### 会话劫持

- 攻击者通过某种手段得到用户的会话ID，并伪装成用户，达到攻击的目的


###### 密码破解

- 算出密码，突破认证；
- 穷举法：指对所有密钥集合构成的密钥空间进行穷举 
- 字典攻击：利用事先收集好的候选密码，经过各种方式组合存入字典，枚举字典中的密码通过认证 
- 彩虹表：明文密码及与之对应的散列值构成的一张数据库表，是一种实现制作庞大的彩虹表

###### 点击劫持

- 利用透明的按钮或链接做成陷阱，覆盖在Web页面之上，然后诱使用户点击访问内容的一种手段；


###### DOS攻击(拒绝服务攻击)

- 一种让运行中的服务呈停止状态的攻击，发送大量请求让服务器难以分辨何为正常请求，何为攻击请求；


###### 后门程序

- 开发人员设置的隐藏入口；    